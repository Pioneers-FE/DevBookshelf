# 소스코드의 종류
코드의 종류 크게 4가지. 코드가 평가될때 관련 코드 컨텍스트가 생성된다.

- 전역 코드
    
    전역 변수, 함수를 전역 객체에 바인딩해야 한다. 따라서 전역코드가 평가되면 전역 실행 컨텍스트가 생성된다. 
    
- 함수 코드
    - 지역스코프를 생성하고 매개변수, arguments 객체를 관리
    - 스코프 체인 연결
- eval 코드
    
    strict 모드에서 독자적인 스코프 생성
    
- 모듈 코드
    
    모듈별 독립 스코프 생성. 
    
# 자료구조(실행 컨텍스트, 렉시컬 환경)
자바스크립트 엔진은 크게 2가지 과정을 거쳐 소스코드를 해석. “소스코드 평가”, “소스코드 실행”

소스코드 평가 과정에서 실행컨텍스트 생성하고 바인딩하는 작업. 함수가 호출되면 해당 함수에 대한 실행컨텍스트 생성하고 실행. 이런과정을 거친다. 

실행 컨텍스트를 이루는 컴포넌트 렉시컬 환경. 실행컨텍스트가 실행순서를 관리한다면 렉시컬 환경은 데이터 참조를 관리하는 자료구조.

렉시컬 환경은 크게 2가지 구성요소를 갖는다. 

1. Environment Record 
    
    데이터
    
2. Outer Lexical Enviornment Reference
    
    해당 실행컨텍스트를 생성한 상위 코드의 렉시컬 환경. 이를 통해 스코프 체인을 구현한다. 
    

# 실행과정
```jsx
var x = 1;
const y = 2;

function foo (a) {
	var x = 3; 
	const y = 4;
	
	function bar (b) {
		const z = 5;
		console.log(a + b + x + y + z);
	}
	
	bar(10);
}

foo(20)
```

다음코드가 실행될때 일어나는 일

1. 전역객체 생성 
2. 전역코드 평가
    1. 전역 실행 컨텍스트 생성
    2. 전역 렉시컬 환경 생성
    3. 전역 환경 레코드 생성 
        - 객체 환경 레코드(Object Environment Record) : var키워드 선언 전역 변수, 함수선언문이 전역함수가 전역객체(BindingObject)에 연결된다. 호이스팅이 발생하는 이유.
        - 선언적 환경 레코드 생성(Declarative Environment Record) : let, const 키워드로 선언안 변수. 그러나 어떤 객체에 바인딩되지 않고 개념적인 블록만 생성된다. TDZ가 존재하는 이유.
    4. this 바인딩
        
        전역환경 레코드의 GlobalThisValue 내부슬롯에 this가 바인딩된다. 
        
    5. 전역 외부 렉시컬 환경 참조 
        
        전역의 경우 상위 스코프가 없으므로 null.
        
3. 전역코드 실행
    
    평가가 완료됐기 때문에 이제 실행이된다. 이때 식별자를 참조할때 환경 레코드를 활용하게 된다. 
    
4. foo 함수 코드 평가 
    
    foo함수가 호출되면 제어권이 foo로 이동하고 foo가 평가되게 된다. 
    
    1. 함수 실행 컨텍스트 생성
    2. 함수 렉시컬 환경 생성
        1. 환경레코드
            
            매개변수, arguments, 함수 내부 지역변수, 중첩함수를 등록하고 관리. 
            
        2. this 바인딩
        3. 외부 렉시컬 환경 참조
            
            foo 함수 정의가 `평가된 시점`에 실행중인 실행 컨텍스트의 렉시컬 환경 참조가 할당된다. 따라서 이 경우에는 전역 컨텍스트가 된다. 이 때문에 함수 호출 시점이 아닌 정의 시점의 스코프가 상위 스코프가 된다. 
            
5. foo 함수 실행
6. bar 함수 평가 및 bar 함수 실행 
7. bar 함수 → foo 함수→ 전역코드 실행 종료
    
    bar의 실행컨텍스트는 스택에서 제거가 된다. 그러나 렉시컬 환경은 누군가 참조하고 있다면 소멸되지 않고 살아있게 된다.
