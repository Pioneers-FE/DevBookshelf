## 24장 클로저

### 24.1 렉시컬 스코프

렉시컬 스코프: js 엔진은 함수의 정의 위치에 따라 상위 스코프를 결정

상위 스코프에 대한 참조는 함수 정의가 평가되는 시점에 함수가 정의된 위치에 의해 결정

### 24.2 함수 객체의 내부 슬롯 [[Environment]]

함수는 자신의 내부 슬롯에 상위 스코프 참조를 저장

```jsx
const x = 1;

function foo() {
  const x = 10;
  bar();
}

function bar() {
  console.log(x);
}
```

foo함수에서 bar 함수를 실행하지만 bar 함수 정의 평가가 되는 시점은 전역 렉시컬 환경

bar의 [[Environment]]는 전역 렉시컬 환경

함수 코드 평가 순서

1. 함수 실행 컨텍스트 생성
2. 함수 렉시컬 환경 생성
   1. 함수 환경 레코드 생성
   2. this 바인딩
   3. 외부 렉시컬 환경에 대한 참조 결정

2-3 외부 렉시컬 환경에 대한 참조에서 [[Environment]] 에 저장된 렉시컬 환경 참조가 할당

### 24.3 클로저와 렉시컬 환경

외부 함수보다 중첩 함수가 더 오래 유지되는 경우, 중첩 함수는 이미 종료된 외부 함수의 변수를 참조 할 수 있다. 그 중첩 함수를 클로저라한다.

함수의 실행 컨텍스트는 제거되지만 렉시컬 환경까지 소멸하는 것은 아니다.

종료된 함수의 렉시컬 환경이라도 내부 슬롯에 의해 참조되고 있으므로 가비지 컬렉션의 대상이 되지 않는다.

1. 중첩 함수라도 상위 스코프의 식별자를 참조하지 않으면 최적화로 소멸, 클로저가 아니다
2. 클로저 이지만 외부 함수보다 일찍 소멸한다면 클로저가 아니다.
3. 중첩 함수가 상위 스코프의 식별자를 참조, 중첩 함수가 외부 함수보다 더 오래 유지되면 클로저이다.

### 24.4 클로저의 활용

상태를 안전하게 변경하고 유지를 위해 사용

상태를 안전하게 은닉, 특정 함수 에게만 상태 변경을 허용

```jsx
const increase = (function () {
  let num = 0;

  return function () {
    return ++num;
  };
})();

console.log(increase()); // 1
console.log(increase()); // 2
console.log(increase()); // 3
```

### 24.6 자주 발생하는 실수

자바스크립트의 함수 레벨 스코프의 특성으로 인해 for문의 변수 선언문에서 var 키워드로 선언한 변수는 전역 변수가 되어 let을 사용
