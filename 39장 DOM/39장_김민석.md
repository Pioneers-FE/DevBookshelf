## 39장 DOM

DOM: HTML 문서의 계층적 구조 정보를 표현하고 이를 제어할 수 있는 API, 프로퍼티와 메서드를 제공하는 트리 자료 구조

### 39.1 노드

HTML 요소: HTML 문서를 구성하는 개별적 요소, 렌더링 엔진에 의해 파싱 -> DOM을 구성하는 요소 노드 객체로 파싱

어트리뷰트 -> 어트리뷰트 노드, 텍스트 콘텐츠 -> 텍스트 노드로 변환

```html
<div class="greeting">Hello</div>
```

요소 노드 : div
어트리뷰트 노드: class="greeting"
텍스트 노드: "Hello"

요소 간의 중첩 관계에 의해 계층적인 부자 관계가 형성

트리 자료구조: 부모 노드와 자식 노드로 구성, 비선형 자료구조, 최상위 노드(root node)부터 시작하여 0개 이상의 자식을 갖음,
자식 노드가 없는 노드(leaf node)

DOM: 노드 객체들로 구성된 트리 자료 구조

문서 노드: 루트 노드, document 객체, window.document또는 document로 참조

어트리뷰트 노드: 부모노드와 연결되지 않고 요소 노드와만 연결

텍스트 노드: 요소 노드의 자식, 리프 노드가

#### 상속받는 인터페이스

- 모든 노드 객체: Object, EventTarget, Node
- 문서 노드: Document, HTMLDocument
- 어트리뷰트 노드: Attr
- 텍스트 노드: CharacterData
- 요소 노드: Element

### 39.2 요소 노드 취득

##### getElementById

id 어트리뷰트 값을 갖는 하나의 요소 노드 탐색, 반환

Docmuent.prototype의 프로퍼티이기 때문에 document를 통해 호출

id는 유일한 값이지만 중복이여도 첫 번째 요소 노드 반환, 없으면 null 반환

##### getElementsByTagName

태그 이름을 갖는 모든 요소 노드를 탐색, 반환, HTMLCollection 객체 반환

모든 요소 취득에는 인수로 '\*' 전달

document를 통해 호출 가능, 요소 노드를 통해서도 호출 가능

##### getElementsByClassName

class 어트리뷰트 값을 갖는 모든 요소 노드를 탐색, 반환, HTMLCollection 객체 반환

document를 통해 호출 가능, 요소 노드를 통해서도 호출 가능

##### querySelector

CSS 선택자를 만족시키는 하나의 요소 노드 탐색, 반환

여러개를 만족하면 첫번째 요소 노드만 반환, 없으면 null, 문법에 맞지않는 CSS 선택자이면 DOMException 에러

##### querySelectorAll

CSS 선택자를 만족시키는 모든 요소 노드 탐색, 반환, NodeList 객체 반환(유사 배열 객체, 이터러블)

모든 요소 취득에는 인수로 '\*' 전달

선택자 문법을 사용하는 탐색 메소드는 다른 요소 탐색 메서드보다 다소 느림, 구체적인 조건으로 취득 가능, 일관된 방식으로 취득 가능

##### matches

CSS 선택자로 특정 요소를 취득할 수 있는지 확인

#### HTMLCollection과 NodeList

##### HTMLCollection

상태 변화 실시간 반영, 살아있는 객체

실시간으로 객체의 상태가 변경될 때 탐색 메서드와 일치하지 않으면 실시간 제거, 부작용이 있다

##### NodeList

실시간으로 상태 변화를 반영하지 않는다

childNodes 프로퍼티가 반환하는 NodeList 객체는 살아있는 객체이므로 주의

HTMLCollection을 NodeList로 변환하여 사용을 권장

### 39.3 노드 탐색

노드 탐색 프로퍼티는 모두 접근자 프로퍼티, getter 만 존재(읽기 전용 접근자 프로퍼티)

##### 공백 텍스트 노드

스페이스, 탭, 줄바꿈 등 공백 문자는 텍스트 노드를 생성

##### 자식 노드 탐색

Node.prototype.childNodes: 자식 노드 전체를 NodeList에 반환, 요소 노드, 텍스트 노드 포함

Element.prototype.children: 자식 노드 중 요소 노드만 HTMLCollection에 반환

Node.prototype.firstChild: 첫번째 자식 노드 반환, 텍스트 노드 or 요소 노드

Node.prototype.lastChild: 마지막 자식 노드 반환, 텍스트 노드 or 요소 노드

Element.prototype.firstElementChild: 첫번째 자식 노드 반환, 요소 노드

Element.prototype.lastElementChild: 마지막 자식 노드 반환, 요소 노드

##### 자식 노드 존재 확인

hasChildNodes: 자식 노드 존재 여부를 반환, 텍스트 노드 포함

childElementCount: 요소 노드만 존재하는지 확인(개수로 반환)

##### 부모 노드 탐색

parentNode

##### 형제 노드 탐색

Node.prototype.previousSibling: 부모가 같은 노드들 중 자기 이전 형제 노드 반환, 요소 노드 or 텍스트 노드

Node.prototype.nextSibling: 부모가 같은 노드들 중 자기 다음 형제 노드 반환, 요소 노드 or 텍스트 노드

Element.prototype.previousElementSibling: 부모가 같은 노드들 중 자기 이전 형제 노드 반환, 요소 노드

Element.prototype.nextElementSibling: 부모가 같은 노드들 중 자기 다음 형제 노드 반환, 요소 노드

### 39.4 노드 정보 취득

- Node.prototype.nodeType: 노드 객체의 종류,

  - Node.ELEMENT_NODE: 요소 노드 타입 (1)
  - Node.TEXT_NODE: 텍스트 노드 타입 (3)
  - Node.DOCUMENT_NODE: 문서 노드 타입 (9)

- Node.prototype.nodeName: 노드의 이름을 문자열로 반환
  - 요소 노드: 태그 이름을 대문자 문자열로 반환
  - 텍스트 노드: "#text" 반환
  - 문서 노드: "#document" 반환

### 39.5 요소 노드의 텍스트 조작

##### nodeValue

getter, setter 모두 존재하는 접근자 프로퍼티

노드 객체의 텍스트 노드 반환

```html
<div id="foo">Hello</div>

<script>
    const $foo = document.getElementById('foo')
    console.log($foo.nodeValue) // null

    const $textNode = $foo.firstChild
    console.log($textNode.nodeValue) // Hello

    $textNode.nodeValue = "World";
    console.log($textNode.nodeValue) // World
```

##### textContent

getter, setter 모두 존재하는 접근자 프로퍼티

요소 노드의 텍스트, 모든 자손 노드의 텍스트를 반환

```html
<div id="foo">Hello <span>World</span></div>

<script>
    console.log(document.getElementById('foo').textContent) // Hello World

    document.getElementById('foo').textContent = 'Hi <span>there!</span>'

    console.log(document.getElementById('foo').textContent) // Hi there!
```

### 39.6 DOM 조작

새로운 노드 생성하여 DOM에 추가, 기존 노드 삭제 또는 교체, 리플로우, 리페인트가 발생

##### innerHTML

요소 노드내 포함된 모든 HTML을 문자열로 반환

XSS 공격에 취약하기 때문에 HTML5는 삽입된 script 코드 실행하지 않는다

HTML 새니티제이션: DOMPurify로 잠재적 위협을 제거

##### insertAdjacentHTML

기존 요소를 제거하지 않고 위치 지정, 새로운 요소 삽입

첫번째 인수: beforebegin, afterbegin, beforeend, afterend

```
[beforebegin]<div id="foo">[afterbegin]text[beforeend]</div>[afterend]
```

innerHTML 보다 효율적이고 빠름

##### 노드 생성과 추가

createElement: 요소 노드 생성하여 반환, 매개변수에 태그 이름 문자열 전달, DOM에 추가하지 않는다

createTextNode: 텍스트 노드 생성하여 반환, 매개변수에 문자열 전달, DOM에 추가하지 않는다

appendChild: 매개변수에 전달할 노드 전달, 호출한 노드의 마지막 자식 노드로 추가

##### 복수의 노드 생성과 추가

DocumentFragment 노드: 노드 객체, 부모 노드가 없어서 기존 DOM과 별도로 존재하는 객체

appendChild로 생성된 DocumentFragment를 넣으면 된다

##### 노드 삽입

appendChild: 마지막 노드로 추가

insertBefore: 지정한 위치에 삽입, 인자로 삽입할 요소 노드, 위치

##### 노드 복사

cloneNode 인자로 true(깊은 복사), false(얕은 복사)

##### 노드 교체

replaceChild: 인자로 바꿀 노드, 기존 노드가

##### 노드 삭제

removeChild

### 39.7 어트리뷰트

##### 어트리뷰트 조작

어트리뷰트 조회: getAttribute
어트리뷰트 변경: setAttribute
어트리뷰트 존재 확인: hasAttribute
어트리뷰트 삭제: removeAttribute

HTML 어트리뷰트: HTML 초기 상태 지정, 값은 변하지 않는다

요소 노드는 초기 상태, 최신 상태 관리, 초기 상태: 어티르뷰트 노드가 관리, 최신 상태: DOM 프로퍼티가 관리

data 어트리뷰트: HTMLElement.dataset 프로퍼티로 취득

dataset 프로퍼티: DOMStringMap 객체 반환

### 39.8 스타일

##### 인라인 스타일 조작

style 프로퍼티로 인라인 스타일을 취득, 추가, 변경, CSSStyleDeclaration 객체 반환, 케밥 케이스 사용

##### 클래스 조작

className: class 어트리뷰트를 문자열로 반환

classList: class 어트리뷰트 정보를 담은 DOMTokenList 객체 반환, class 어트리뷰트 정보를 나타내는 컬렉션 객체, 유사 배열 객체, 이터러블

- DOMTokenList
  - add: class 어트리뷰트 값으로 추가
  - remove: class 어트리뷰트에서 삭제
  - item(index): class 어트리뷰트에서 index 위치의 값 반환
  - contains: class 어트리뷰트 포함 여부를
  - replace: class 어트리뷰트 변경
  - toggle: class 어트리뷰트와 일치하면 제거, 없으면 추가

##### 요소에 적용되어 있는 CSS 스타일 참조

getComputedStyle: 첫번째 인수에 적용되어 있는 스타일을 CSSStyleDeclaration 객체로 반환, 두번째 인수로 :after, :before 같은 의사 요소 지정 문자열 전달
